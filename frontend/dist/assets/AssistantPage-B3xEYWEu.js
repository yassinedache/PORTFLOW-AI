import{a as n,h as j,u as S,j as e}from"./vendor-query-CF9v-Zna.js";import{c as N,p as l,r as k,s as f,B as w,t as P,b as I,q as A}from"./index-CEOHBZb-.js";import{P as E,C as R,c as q}from"./card-BhKIbSNR.js";import{I as C}from"./input-DYGPj4ji.js";import{S as H}from"./sparkles-COBm266N.js";import{m as d,A as M}from"./vendor-motion-BvnwsIwX.js";import{L as F}from"./loader-circle-p231RGTX.js";import"./vendor-react-lqZWVjLj.js";import"./vendor-charts-sdUO6Spa.js";import"./vendor-radix-D-AkJh5d.js";import"./vendor-http-BN7VjlME.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=N("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=N("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),m={createSession:async()=>(await l.post("/ai/sessions")).data,query:async t=>(await l.post("/ai/query",t)).data,getHistory:async t=>(await l.get(`/ai/sessions/${t}/history`)).data,getReadiness:async t=>(await l.get(`/ai/readiness/${t}`)).data},L=["Is my next booking at risk?","Show me available slots for tomorrow","What is the busiest terminal today?","Summarise my charges this week","Which of my containers are ready?"];function X(){const t=n.useRef(null),c=n.useRef(null),[u,h]=n.useState(""),[a,b]=n.useState(()=>sessionStorage.getItem("portflow-ai-session")),[x,p]=n.useState([]),y=j({mutationFn:m.createSession,onSuccess:s=>{b(s.id),sessionStorage.setItem("portflow-ai-session",s.id)}}),{isFetching:$}=S({queryKey:A.aiHistory(a??""),queryFn:()=>m.getHistory(a),enabled:!!a,refetchOnMount:"always",select:s=>s});n.useEffect(()=>{a&&m.getHistory(a).then(s=>{s.length&&p(s)}).catch(()=>{})},[a]);const r=j({mutationFn:s=>{if(!a)throw new Error("No session");return m.query({sessionId:a,message:s})},onSuccess:s=>{p(i=>[...i,{role:"assistant",content:s.response}])},onError:()=>I.error("Failed to get response")});n.useEffect(()=>{!a&&!y.isPending&&y.mutate()},[]),n.useEffect(()=>{var s;(s=t.current)==null||s.scrollTo({top:t.current.scrollHeight,behavior:"smooth"})},[x,r.isPending]);const g=s=>{var o;const i=(s??u).trim();!i||r.isPending||(p(v=>[...v,{role:"user",content:i}]),h(""),r.mutate(i),(o=c.current)==null||o.focus())};return e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-7rem)]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6 text-cyan-400"}),"AI Assistant"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ask about bookings, slots, risk predictions, and more"})]}),e.jsxs(R,{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(k,{className:"flex-1 p-4",ref:t,children:e.jsxs("div",{className:"space-y-4 max-w-2xl mx-auto",children:[x.length===0&&!r.isPending&&e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-2xl bg-gradient-to-br from-cyan-500/20 to-purple-500/20 flex items-center justify-center",children:e.jsx(f,{className:"h-8 w-8 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:"How can I help?"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Try one of these or type your own question"})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:L.map(s=>e.jsx(w,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>g(s),children:s},s))})]}),e.jsx(M,{mode:"popLayout",children:x.map((s,i)=>{const o=s.role==="user"||s.role===P.USER;return e.jsxs(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},className:`flex gap-3 ${o?"justify-end":"justify-start"}`,children:[!o&&e.jsx("div",{className:"shrink-0 w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500/20 to-purple-500/20 flex items-center justify-center",children:e.jsx(f,{className:"h-4 w-4 text-cyan-400"})}),e.jsx("div",{className:`
                          max-w-[75%] rounded-2xl px-4 py-2.5 text-sm leading-relaxed
                          ${o?"bg-cyan-500/20 text-foreground rounded-br-md":"glass rounded-bl-md"}
                        `,children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.content})}),o&&e.jsx("div",{className:"shrink-0 w-8 h-8 rounded-lg bg-foreground/10 flex items-center justify-center",children:e.jsx(U,{className:"h-4 w-4"})})]},i)})}),r.isPending&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"flex gap-3 items-start",children:[e.jsx("div",{className:"shrink-0 w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500/20 to-purple-500/20 flex items-center justify-center",children:e.jsx(f,{className:"h-4 w-4 text-cyan-400"})}),e.jsx("div",{className:"glass rounded-2xl rounded-bl-md px-4 py-3 flex gap-1.5",children:[0,1,2].map(s=>e.jsx(d.span,{className:"w-2 h-2 rounded-full bg-cyan-400",animate:{opacity:[.3,1,.3]},transition:{duration:1,repeat:1/0,delay:s*.2}},s))})]})]})}),e.jsx(q,{className:"p-4 border-t border-border/50",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),g()},className:"flex gap-2 max-w-2xl mx-auto",children:[e.jsx(C,{ref:c,value:u,onChange:s=>h(s.target.value),placeholder:"Ask anything about your port operationsâ€¦",disabled:r.isPending||!a,className:"flex-1"}),e.jsx(w,{type:"submit",size:"icon",variant:"glow",disabled:!u.trim()||r.isPending,children:r.isPending?e.jsx(F,{className:"h-4 w-4 animate-spin"}):e.jsx(T,{className:"h-4 w-4"})})]})})]})]})})}export{X as default};
