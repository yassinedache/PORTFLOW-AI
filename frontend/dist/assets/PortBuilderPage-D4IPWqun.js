import{a as c,j as e,f as Ce,u as k,h as j}from"./vendor-query-CF9v-Zna.js";import{c as be,f as H,Z as M,q as o,B as n,d as R,e as Te,h as X,b as l}from"./index-CEOHBZb-.js";import{P as we,C as Y,a as _,b as ee,c as B,B as se}from"./card-BhKIbSNR.js";import{E as ae}from"./EmptyState-CSoHTzce.js";import{P as Se}from"./Skeletons-CfQltb1a.js";import{T as $,C as ke}from"./ConfirmDialog-I5Y_R0U2.js";import{E as Fe}from"./ErrorAlert-DJ0FKV30.js";import{I as h}from"./input-DYGPj4ji.js";import{L as m}from"./label-BxPWq3jm.js";import{S as Ae,a as qe,b as Ee,c as Ge,d as Ze}from"./select-BcYq-aZE.js";import{D as F,a as A,b as q,c as E,d as G,e as Z}from"./dialog-BAM1R5W1.js";import{d as De,L as ie,T as ne,e as re}from"./vendor-radix-D-AkJh5d.js";import{a as d}from"./admin-C8fNhm0J.js";import{P as D}from"./plus-Bw4WFV0g.js";import{m as z,A as ze}from"./vendor-motion-BvnwsIwX.js";import{D as te}from"./door-open-BR1_l2_f.js";import{M as Ke}from"./map-pin-Cst-MQK0.js";import"./vendor-react-lqZWVjLj.js";import"./vendor-charts-sdUO6Spa.js";import"./vendor-http-BN7VjlME.js";import"./circle-alert-CA5_1Jce.js";import"./chevron-down-CVmmBZsX.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=be("Layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),Ie=De,le=c.forwardRef(({className:t,...a},u)=>e.jsx(ie,{ref:u,className:H("inline-flex h-10 items-center justify-center rounded-lg bg-secondary/50 p-1 text-muted-foreground",t),...a}));le.displayName=ie.displayName;const K=c.forwardRef(({className:t,...a},u)=>e.jsx(ne,{ref:u,className:H("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-primary/20 data-[state=active]:text-primary data-[state=active]:shadow-sm cursor-pointer",t),...a}));K.displayName=ne.displayName;const L=c.forwardRef(({className:t,...a},u)=>e.jsx(re,{ref:u,className:H("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a}));L.displayName=re.displayName;function ls(){const t=Ce(),[a,u]=c.useState(null),[ce,f]=c.useState(!1),[oe,v]=c.useState(!1),[de,N]=c.useState(!1),[me,C]=c.useState(!1),[r,p]=c.useState(null),[y,I]=c.useState({name:"",location:""}),[P,V]=c.useState({name:""}),[g,b]=c.useState({name:"",type:M.GENERAL,maxTrucks:50}),[x,T]=c.useState({startTime:"",endTime:"",capacity:10}),{data:w,isLoading:ue,isError:xe,refetch:he}=k({queryKey:o.terminals,queryFn:d.getTerminals}),{data:O}=k({queryKey:o.gates,queryFn:d.getGates}),{data:Q}=k({queryKey:o.zones(),queryFn:()=>d.getZones()}),J=new Date().toISOString().split("T")[0],{data:S}=k({queryKey:o.slotsAvailability((a==null?void 0:a.id)??"",J),queryFn:()=>d.getSlotAvailability(a.id,J),enabled:!!a}),je=j({mutationFn:d.createTerminal,onSuccess:()=>{t.invalidateQueries({queryKey:o.terminals}),f(!1),I({name:"",location:""}),l.success("Terminal created")},onError:()=>l.error("Failed to create terminal")}),pe=j({mutationFn:d.deleteTerminal,onSuccess:()=>{t.invalidateQueries({queryKey:o.terminals}),u(null),l.success("Terminal deleted")},onError:()=>l.error("Failed to delete terminal")}),ye=j({mutationFn:d.createGate,onSuccess:()=>{t.invalidateQueries({queryKey:o.gates}),t.invalidateQueries({queryKey:o.terminals}),v(!1),V({name:""}),l.success("Gate created")},onError:()=>l.error("Failed to create gate")}),ge=j({mutationFn:d.deleteGate,onSuccess:()=>{t.invalidateQueries({queryKey:o.gates}),t.invalidateQueries({queryKey:o.terminals}),l.success("Gate deleted")},onError:()=>l.error("Failed to delete gate")}),fe=j({mutationFn:d.createZone,onSuccess:()=>{t.invalidateQueries({queryKey:o.zones()}),N(!1),b({name:"",type:M.GENERAL,maxTrucks:50}),l.success("Zone created")},onError:()=>l.error("Failed to create zone")}),ve=j({mutationFn:d.deleteZone,onSuccess:()=>{t.invalidateQueries({queryKey:o.zones()}),l.success("Zone deleted")},onError:()=>l.error("Failed to delete zone")}),Ne=j({mutationFn:d.createTimeSlot,onSuccess:()=>{t.invalidateQueries({queryKey:["slots"]}),C(!1),T({startTime:"",endTime:"",capacity:10}),l.success("Time slot created")},onError:()=>l.error("Failed to create time slot")});if(ue)return e.jsx(Se,{});if(xe)return e.jsx(Fe,{onRetry:he});const U=a?(O==null?void 0:O.filter(s=>s.terminalId===a.id))||[]:[],W=a?(Q==null?void 0:Q.filter(s=>s.terminalId===a.id))||[]:[];return e.jsxs(we,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Port Builder"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure terminals, gates, zones, and time slots"})]}),e.jsxs(n,{variant:"glow",onClick:()=>f(!0),children:[e.jsx(D,{className:"h-4 w-4"}),"New Terminal"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs(Y,{className:"lg:col-span-1",children:[e.jsx(_,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-primary"}),"Terminals"]})}),e.jsx(B,{children:w!=null&&w.length?e.jsx("div",{className:"space-y-2",children:w.map(s=>e.jsxs(z.button,{whileHover:{x:4},onClick:()=>u(s),className:`w-full rounded-lg p-3 text-left transition-all ${(a==null?void 0:a.id)===s.id?"bg-primary/15 ring-1 ring-primary/30":"hover:bg-secondary"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:`h-2 w-2 rounded-full ${s.isActive?"bg-success":"bg-destructive"}`})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.location})]},s.id))}):e.jsx(ae,{title:"No terminals",description:"Create your first terminal to get started",icon:e.jsx(R,{className:"h-8 w-8 text-muted-foreground"})})})]}),e.jsx(Y,{className:"lg:col-span-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ee,{children:a.name}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>p({type:"terminal",id:a.id,label:a.name}),children:[e.jsx($,{className:"mr-1 h-3 w-3"}),"Delete"]})})]})}),e.jsx(B,{children:e.jsxs(Ie,{defaultValue:"gates",children:[e.jsxs(le,{children:[e.jsxs(K,{value:"gates",children:[e.jsx(te,{className:"mr-1 h-3 w-3"}),"Gates (",U.length,")"]}),e.jsxs(K,{value:"zones",children:[e.jsx(Le,{className:"mr-1 h-3 w-3"}),"Zones (",W.length,")"]}),e.jsxs(K,{value:"slots",children:[e.jsx(Te,{className:"mr-1 h-3 w-3"}),"Time Slots"]})]}),e.jsxs(L,{value:"gates",className:"mt-4 space-y-3",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>v(!0),children:[e.jsx(D,{className:"mr-1 h-3 w-3"}),"Add Gate"]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:e.jsx(ze,{children:U.map(s=>e.jsxs(z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"flex items-center justify-between rounded-lg bg-secondary/50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p({type:"gate",id:s.id,label:s.name}),children:e.jsx($,{className:"h-3 w-3 text-destructive"})})]},s.id))})})]}),e.jsxs(L,{value:"zones",className:"mt-4 space-y-3",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>N(!0),children:[e.jsx(D,{className:"mr-1 h-3 w-3"}),"Add Zone"]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:W.map(s=>e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-between rounded-lg bg-secondary/50 p-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-accent"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx(se,{variant:"outline",children:s.type}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Max: ",s.maxTrucks]})]})]}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p({type:"zone",id:s.id,label:s.name}),children:e.jsx($,{className:"h-3 w-3 text-destructive"})})]},s.id))})]}),e.jsxs(L,{value:"slots",className:"mt-4 space-y-3",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>C(!0),children:[e.jsx(D,{className:"mr-1 h-3 w-3"}),"Add Time Slot"]}),S!=null&&S.length?e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-between rounded-lg border border-border/50 bg-card/50 p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"text-sm font-medium",children:[X(s.startTime)," â€“"," ",X(s.endTime)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.availableCount," / ",s.capacity," ","available"]})]}),e.jsx(se,{variant:s.availableCount>0?"secondary":"destructive",children:s.availableCount>0?"Open":"Full"})]},s.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No time slots configured for today. Add one above."})]})]})})]}):e.jsx(B,{className:"py-16",children:e.jsx(ae,{title:"Select a terminal",description:"Choose a terminal from the list to manage its gates, zones, and slots",icon:e.jsx(R,{className:"h-8 w-8 text-muted-foreground"})})})})]})]}),e.jsx(F,{open:ce,onOpenChange:f,children:e.jsxs(A,{children:[e.jsxs(q,{children:[e.jsx(E,{children:"Create Terminal"}),e.jsx(G,{children:"Add a new terminal to your port"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Name"}),e.jsx(h,{value:y.name,onChange:s=>I(i=>({...i,name:s.target.value})),placeholder:"Terminal A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Location"}),e.jsx(h,{value:y.location,onChange:s=>I(i=>({...i,location:s.target.value})),placeholder:"North Dock"})]})]}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(n,{variant:"glow",onClick:()=>je.mutate(y),disabled:!y.name||!y.location,children:"Create"})]})]})}),e.jsx(F,{open:oe,onOpenChange:v,children:e.jsxs(A,{children:[e.jsxs(q,{children:[e.jsx(E,{children:"Add Gate"}),e.jsxs(G,{children:["Add a gate to ",a==null?void 0:a.name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Gate Name"}),e.jsx(h,{value:P.name,onChange:s=>V({name:s.target.value}),placeholder:"Gate 1"})]})}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(n,{variant:"glow",onClick:()=>a&&ye.mutate({name:P.name,terminalId:a.id}),disabled:!P.name,children:"Add Gate"})]})]})}),e.jsx(F,{open:de,onOpenChange:N,children:e.jsxs(A,{children:[e.jsxs(q,{children:[e.jsx(E,{children:"Add Zone"}),e.jsxs(G,{children:["Add a zone to ",a==null?void 0:a.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Zone Name"}),e.jsx(h,{value:g.name,onChange:s=>b(i=>({...i,name:s.target.value})),placeholder:"Zone A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Type"}),e.jsxs(Ae,{value:g.type,onValueChange:s=>b(i=>({...i,type:s})),children:[e.jsx(qe,{children:e.jsx(Ee,{})}),e.jsx(Ge,{children:Object.values(M).map(s=>e.jsx(Ze,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Max Trucks"}),e.jsx(h,{type:"number",value:g.maxTrucks,onChange:s=>b(i=>({...i,maxTrucks:Number(s.target.value)}))})]})]}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(n,{variant:"glow",onClick:()=>a&&fe.mutate({...g,terminalId:a.id}),disabled:!g.name,children:"Add Zone"})]})]})}),e.jsx(F,{open:me,onOpenChange:C,children:e.jsxs(A,{children:[e.jsxs(q,{children:[e.jsx(E,{children:"Add Time Slot"}),e.jsxs(G,{children:["Create a time slot for ",a==null?void 0:a.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Start Time"}),e.jsx(h,{type:"datetime-local",value:x.startTime,onChange:s=>T(i=>({...i,startTime:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"End Time"}),e.jsx(h,{type:"datetime-local",value:x.endTime,onChange:s=>T(i=>({...i,endTime:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Capacity"}),e.jsx(h,{type:"number",value:x.capacity,onChange:s=>T(i=>({...i,capacity:Number(s.target.value)}))})]})]}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(n,{variant:"glow",onClick:()=>a&&Ne.mutate({terminalId:a.id,startTime:new Date(x.startTime).toISOString(),endTime:new Date(x.endTime).toISOString(),capacity:x.capacity}),disabled:!x.startTime||!x.endTime,children:"Create Slot"})]})]})}),e.jsx(ke,{open:!!r,onOpenChange:s=>!s&&p(null),onConfirm:()=>{r&&(r.type==="terminal"?pe.mutate(r.id):r.type==="gate"?ge.mutate(r.id):r.type==="zone"&&ve.mutate(r.id),p(null))},title:`Delete ${r==null?void 0:r.type}?`,description:`This will permanently delete "${r==null?void 0:r.label}". This action cannot be undone.`,confirmLabel:"Delete"})]})}export{ls as default};
