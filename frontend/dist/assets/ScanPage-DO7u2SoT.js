const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-qr-B_hbMkRx.js","assets/vendor-query-CF9v-Zna.js"])))=>i.map(i=>d[i]);
import{c as q,_ as Q,b as y,G as M,B as x,y as I,Q as P,q as T}from"./index-CEOHBZb-.js";import{a as r,u as _,h as G,j as e}from"./vendor-query-CF9v-Zna.js";import{P as D,C as h,c as f,l as H,n as O,a as V,b as $}from"./card-BhKIbSNR.js";import{I as z}from"./input-DYGPj4ji.js";import{L as K}from"./label-BxPWq3jm.js";import{a as B}from"./admin-C8fNhm0J.js";import{g as F}from"./gate-CRNuKIBj.js";import{A as W,m as N}from"./vendor-motion-BvnwsIwX.js";import{L as X}from"./loader-circle-p231RGTX.js";import"./vendor-react-lqZWVjLj.js";import"./vendor-charts-sdUO6Spa.js";import"./vendor-radix-D-AkJh5d.js";import"./vendor-http-BN7VjlME.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=q("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=q("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);function me(){var w,S,E;const[i,p]=r.useState(""),[s,b]=r.useState(""),[t,j]=r.useState(null),[k,o]=r.useState(!1),C=r.useRef(null),g=r.useRef(null),{data:c}=_({queryKey:T.gates,queryFn:B.getGates});r.useEffect(()=>{c&&c.length>0&&!s&&b(c[0].id)},[c,s]);const d=G({mutationFn:F.scan,onSuccess:a=>{j(a),m()},onError:()=>y.error("Scan failed — please try again")}),L=r.useCallback(async()=>{if(C.current){o(!0),j(null);try{const{Html5Qrcode:a}=await Q(async()=>{const{Html5Qrcode:u}=await import("./vendor-qr-B_hbMkRx.js").then(R=>R.a);return{Html5Qrcode:u}},__vite__mapDeps([0,1])),n=new a("qr-reader");g.current=n,await n.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},u=>{p(u),n.stop().catch(()=>{}),o(!1),s&&d.mutate({qrToken:u,gateId:s})},()=>{})}catch(a){console.error("Camera error:",a),y.error("Could not access camera"),o(!1)}}},[s]),m=r.useCallback(()=>{var a,n;(n=(a=g.current)==null?void 0:a.stop)==null||n.call(a).catch(()=>{}),g.current=null,o(!1)},[]);r.useEffect(()=>()=>m(),[m]);const v=()=>{if(!i.trim()||!s){y.error("Enter a QR token and select a gate");return}d.mutate({qrToken:i.trim(),gateId:s})},A=()=>{j(null),p("")},l=(t==null?void 0:t.result)===M.ALLOWED;return e.jsx(D,{children:e.jsxs("div",{className:"space-y-6 max-w-xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Gate Scanner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan booking QR codes to grant or deny access"})]}),e.jsx(h,{children:e.jsxs(f,{className:"p-4",children:[e.jsx(K,{className:"mb-2 block",children:"Select Gate"}),e.jsxs("select",{value:s,onChange:a=>b(a.target.value),className:"flex h-10 w-full items-center rounded-lg border border-border bg-secondary/50 px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("option",{value:"",children:"Select a gate..."}),c==null?void 0:c.map(a=>{var n;return e.jsxs("option",{value:a.id,children:[a.name," ",(n=a.terminal)!=null&&n.name?`(${a.terminal.name})`:""]},a.id)})]})]})}),e.jsx(W,{mode:"wait",children:t?e.jsx(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",duration:.5},children:e.jsx(h,{className:`border-2 ${l?"border-emerald-500/50 bg-emerald-500/5":"border-red-500/50 bg-red-500/5"}`,children:e.jsxs(f,{className:"p-8 text-center space-y-4",children:[e.jsx(N.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.1},className:`mx-auto w-20 h-20 rounded-full flex items-center justify-center ${l?"bg-emerald-500/20":"bg-red-500/20"}`,children:l?e.jsx(H,{className:"h-10 w-10 text-emerald-400"}):e.jsx(O,{className:"h-10 w-10 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:`text-3xl font-bold ${l?"text-emerald-400":"text-red-400"}`,children:l?"ACCESS ALLOWED":"ACCESS DENIED"}),t.reason&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.reason})]}),t.booking&&e.jsxs("div",{className:"text-left glass rounded-lg p-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Terminal"}),e.jsx("span",{className:"font-medium",children:(w=t.booking.terminal)==null?void 0:w.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Container"}),e.jsx("span",{className:"font-mono",children:((S=t.booking.container)==null?void 0:S.containerNumber)||"—"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Truck"}),e.jsx("span",{className:"font-mono",children:((E=t.booking.truck)==null?void 0:E.plate)||"—"})]})]}),e.jsxs(x,{variant:"outline",className:"mt-4",onClick:A,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Scan Another"]})]})})},"result"):e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-4",children:[e.jsx(h,{children:e.jsxs(f,{className:"p-4 space-y-4",children:[e.jsx("div",{id:"qr-reader",ref:C,className:"rounded-lg overflow-hidden bg-black/50 min-h-[280px] flex items-center justify-center",children:!k&&e.jsxs("div",{className:"text-center p-8 space-y-3",children:[e.jsx(J,{className:"h-12 w-12 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click below to start camera"})]})}),e.jsx("div",{className:"flex gap-2",children:k?e.jsx(x,{className:"flex-1",variant:"outline",onClick:m,children:"Stop Camera"}):e.jsxs(x,{className:"flex-1",variant:"glow",onClick:L,disabled:!s,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Start Camera"]})})]})}),e.jsxs(h,{children:[e.jsx(V,{children:e.jsx($,{className:"text-sm text-muted-foreground",children:"Or enter QR token manually"})}),e.jsxs(f,{className:"space-y-3",children:[e.jsx(z,{value:i,onChange:a=>p(a.target.value),placeholder:"Paste QR token...",onKeyDown:a=>a.key==="Enter"&&v()}),e.jsxs(x,{className:"w-full",variant:"outline",disabled:!i.trim()||!s||d.isPending,onClick:v,children:[d.isPending?e.jsx(X,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(P,{className:"h-4 w-4 mr-2"}),"Verify Token"]})]})]})]},"scanner")})]})})}export{me as default};
