import{f as A,a as k,u as c,h as P,j as e}from"./vendor-query-CF9v-Zna.js";import{q as t,B as d,C as V,h as I,j as L,b as T}from"./index-CEOHBZb-.js";import{P as H,C as Q,c as R,S as M}from"./card-BhKIbSNR.js";import{E as O}from"./EmptyState-CSoHTzce.js";import{T as $}from"./Skeletons-CfQltb1a.js";import{E as z}from"./ErrorAlert-DJ0FKV30.js";import{I as Y}from"./input-DYGPj4ji.js";import{L as m}from"./label-BxPWq3jm.js";import{S as h,a as j,b as p,c as y,d as g}from"./select-BcYq-aZE.js";import{D as G,a as J,b as U,c as W,d as X,e as Z}from"./dialog-BAM1R5W1.js";import{T as _,a as ee,b as ae,c as i,d as se,e as l}from"./table-BH3eB_Rj.js";import{a as re}from"./admin-C8fNhm0J.js";import{c as x}from"./carrier-DbPZWpzb.js";import{P as w}from"./plus-Bw4WFV0g.js";import{m as te}from"./vendor-motion-BvnwsIwX.js";import{E as ie}from"./eye-DcB9CqbW.js";import{b as le}from"./vendor-react-lqZWVjLj.js";import"./vendor-charts-sdUO6Spa.js";import"./vendor-radix-D-AkJh5d.js";import"./vendor-http-BN7VjlME.js";import"./circle-alert-CA5_1Jce.js";import"./chevron-down-CVmmBZsX.js";function Be(){const N=le(),B=A(),[q,n]=k.useState(!1),[s,o]=k.useState({terminalId:"",timeSlotId:"",containerId:"",truckId:"",date:new Date().toISOString().split("T")[0]}),{data:u,isLoading:D,isError:E,refetch:F}=c({queryKey:t.myBookings,queryFn:x.getMyBookings}),{data:f}=c({queryKey:t.terminals,queryFn:re.getTerminals}),{data:v}=c({queryKey:t.trucks,queryFn:x.getTrucks}),{data:S}=c({queryKey:t.containers,queryFn:x.getContainers}),{data:C}=c({queryKey:t.slotsAvailability(s.terminalId,s.date),queryFn:()=>x.getAvailability(s.terminalId,s.date),enabled:!!s.terminalId&&!!s.date}),K=P({mutationFn:x.createBooking,onSuccess:a=>{B.invalidateQueries({queryKey:t.myBookings}),n(!1),T.success("Booking created"),N(`/app/carrier/bookings/${a.id}`)},onError:()=>T.error("Failed to create booking")});return E?e.jsx(z,{onRetry:F}):e.jsxs(H,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Bookings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your booking history"})]}),e.jsxs(d,{variant:"glow",onClick:()=>n(!0),children:[e.jsx(w,{className:"h-4 w-4"}),"New Booking"]})]}),e.jsx(Q,{children:e.jsx(R,{className:"p-0",children:D?e.jsx("div",{className:"p-6",children:e.jsx($,{})}):u!=null&&u.length?e.jsxs(_,{children:[e.jsx(ee,{children:e.jsxs(ae,{children:[e.jsx(i,{children:"Terminal"}),e.jsx(i,{children:"Time Slot"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Price"}),e.jsx(i,{children:"Created"}),e.jsx(i,{className:"w-16"})]})}),e.jsx(se,{children:u.map((a,r)=>{var b;return e.jsxs(te.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:r*.02},className:"cursor-pointer border-b border-border/50 transition-colors hover:bg-muted/30",onClick:()=>N(`/app/carrier/bookings/${a.id}`),children:[e.jsx(l,{className:"font-medium",children:((b=a.terminal)==null?void 0:b.name)||"—"}),e.jsx(l,{className:"text-muted-foreground",children:a.timeSlot?I(a.timeSlot.startTime):"—"}),e.jsx(l,{children:e.jsx(M,{status:a.status})}),e.jsx(l,{children:a.price!=null?L(a.price):"—"}),e.jsx(l,{className:"text-muted-foreground",children:I(a.createdAt)}),e.jsx(l,{children:e.jsx(d,{variant:"ghost",size:"icon",children:e.jsx(ie,{className:"h-4 w-4"})})})]},a.id)})})]}):e.jsx(O,{title:"No bookings yet",description:"Create your first booking",icon:e.jsx(V,{className:"h-8 w-8 text-muted-foreground"}),action:e.jsxs(d,{variant:"outline",onClick:()=>n(!0),children:[e.jsx(w,{className:"mr-1 h-4 w-4"}),"New Booking"]})})})})]}),e.jsx(G,{open:q,onOpenChange:n,children:e.jsxs(J,{className:"max-w-lg",children:[e.jsxs(U,{children:[e.jsx(W,{children:"New Booking"}),e.jsx(X,{children:"Select truck, container, and time slot"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Terminal"}),e.jsxs(h,{value:s.terminalId,onValueChange:a=>o(r=>({...r,terminalId:a,timeSlotId:""})),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"Select terminal"})}),e.jsx(y,{children:f==null?void 0:f.map(a=>e.jsx(g,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Date"}),e.jsx(Y,{type:"date",value:s.date,onChange:a=>o(r=>({...r,date:a.target.value,timeSlotId:""}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Time Slot"}),e.jsxs(h,{value:s.timeSlotId,onValueChange:a=>o(r=>({...r,timeSlotId:a})),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"Select slot"})}),e.jsx(y,{children:C==null?void 0:C.filter(a=>a.availableCount>0).map(a=>e.jsxs(g,{value:a.id,children:[I(a.startTime)," — ",a.availableCount," ","available"]},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Container"}),e.jsxs(h,{value:s.containerId,onValueChange:a=>o(r=>({...r,containerId:a})),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"Select container"})}),e.jsx(y,{children:S==null?void 0:S.map(a=>e.jsx(g,{value:a.id,children:a.containerNumber},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Truck (optional)"}),e.jsxs(h,{value:s.truckId,onValueChange:a=>o(r=>({...r,truckId:a})),children:[e.jsx(j,{children:e.jsx(p,{placeholder:"Select truck"})}),e.jsx(y,{children:v==null?void 0:v.map(a=>e.jsx(g,{value:a.id,children:a.plate},a.id))})]})]})]}),e.jsxs(Z,{children:[e.jsx(d,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(d,{variant:"glow",onClick:()=>K.mutate({terminalId:s.terminalId,timeSlotId:s.timeSlotId,containerId:s.containerId,truckId:s.truckId||void 0}),disabled:!s.terminalId||!s.timeSlotId||!s.containerId,children:"Create Booking"})]})]})})]})}export{Be as default};
