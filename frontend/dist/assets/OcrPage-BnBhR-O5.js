import{f as k,a as n,u as T,h as I,j as e}from"./vendor-query-CF9v-Zna.js";import{c as P,h as F,B as M,b as m,O as b}from"./index-CEOHBZb-.js";import{P as R,C as y,c as N,a as H,b as L,l as B}from"./card-BhKIbSNR.js";import{E as J}from"./EmptyState-CSoHTzce.js";import{T as G,a as q,b as U,c as o,d as A,e as i}from"./table-BH3eB_Rj.js";import{D as z,a as Q,b as K,c as V}from"./dialog-BAM1R5W1.js";import{c as C}from"./carrier-DbPZWpzb.js";import{L as p}from"./loader-circle-p231RGTX.js";import{m as D}from"./vendor-motion-BvnwsIwX.js";import{E as $}from"./eye-DcB9CqbW.js";import{C as W}from"./circle-alert-CA5_1Jce.js";import"./vendor-react-lqZWVjLj.js";import"./vendor-charts-sdUO6Spa.js";import"./vendor-radix-D-AkJh5d.js";import"./vendor-http-BN7VjlME.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=P("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=P("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),v={PENDING:{label:"Pending",icon:e.jsx(p,{className:"h-3.5 w-3.5 animate-spin"}),color:"text-yellow-400"},PROCESSING:{label:"Processing",icon:e.jsx(p,{className:"h-3.5 w-3.5 animate-spin"}),color:"text-blue-400"},COMPLETED:{label:"Completed",icon:e.jsx(B,{className:"h-3.5 w-3.5"}),color:"text-emerald-400"},FAILED:{label:"Failed",icon:e.jsx(W,{className:"h-3.5 w-3.5"}),color:"text-red-400"}};function xe(){const w=k(),x=n.useRef(null),[u,c]=n.useState(!1),[t,h]=n.useState(null),[r,O]=n.useState(()=>{try{return JSON.parse(localStorage.getItem("portflow-ocr-jobs")||"[]")}catch{return[]}}),E=n.useCallback(a=>{O(a),localStorage.setItem("portflow-ocr-jobs",JSON.stringify(a))},[]),{data:f=[]}=T({queryKey:["ocr","jobs",r],queryFn:async()=>r.length?(await Promise.all(r.map(s=>C.getOcrJob(s).catch(()=>null)))).filter(Boolean):[],enabled:r.length>0,refetchInterval:a=>{const s=a.state.data;return(s==null?void 0:s.some(j=>j.status===b.PENDING||j.status===b.PROCESSING))?3e3:!1}}),d=I({mutationFn:a=>C.uploadBol(a),onSuccess:a=>{const s=[a.id,...r];E(s),w.invalidateQueries({queryKey:["ocr","jobs"]}),m.success("Document uploaded — OCR processing started")},onError:()=>m.error("Upload failed")}),g=a=>{if(!(a!=null&&a.length))return;const s=a[0];if(s){if(!s.type.startsWith("image/")&&s.type!=="application/pdf"){m.error("Only images and PDF files are supported");return}d.mutate(s)}},S=a=>{a.preventDefault(),c(!1),g(a.dataTransfer.files)};return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"OCR — Bill of Lading"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a Bill of Lading image and auto-extract fields for booking"})]}),e.jsx(y,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{onDragOver:a=>{a.preventDefault(),c(!0)},onDragLeave:()=>c(!1),onDrop:S,onClick:()=>{var a;return(a=x.current)==null?void 0:a.click()},className:`
                relative flex flex-col items-center justify-center gap-3 rounded-xl border-2 border-dashed
                p-12 cursor-pointer transition-all duration-300
                ${u?"border-cyan-400 bg-cyan-400/10 scale-[1.01]":"border-border/60 hover:border-cyan-400/40 hover:bg-card/50"}
              `,children:[d.isPending?e.jsx(p,{className:"h-10 w-10 animate-spin text-cyan-400"}):e.jsx(D.div,{animate:u?{scale:1.15,y:-4}:{scale:1,y:0},children:e.jsx(_,{className:"h-10 w-10 text-muted-foreground"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:d.isPending?"Uploading…":"Drop file here or click to browse"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Supports JPEG, PNG, PDF — max 10 MB"})]}),e.jsx("input",{ref:x,type:"file",accept:"image/*,application/pdf",className:"hidden",onChange:a=>g(a.target.files)})]})})}),e.jsxs(y,{children:[e.jsx(H,{children:e.jsx(L,{className:"text-base",children:"Recent OCR Jobs"})}),e.jsx(N,{className:"p-0",children:f.length?e.jsxs(G,{children:[e.jsx(q,{children:e.jsxs(U,{children:[e.jsx(o,{children:"File"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Created"}),e.jsx(o,{})]})}),e.jsx(A,{children:f.map((a,s)=>{const l=v[a.status]??v.PENDING;return e.jsxs(D.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:s*.03},className:"border-b border-border/50",children:[e.jsx(i,{className:"font-medium truncate max-w-[200px]",children:a.originalFilename||a.id}),e.jsx(i,{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 text-sm ${l.color}`,children:[l.icon," ",l.label]})}),e.jsx(i,{className:"text-muted-foreground text-sm",children:F(a.createdAt)}),e.jsx(i,{children:a.status==="COMPLETED"&&e.jsxs(M,{size:"sm",variant:"ghost",onClick:()=>h(a),children:[e.jsx($,{className:"h-4 w-4 mr-1"})," View"]})})]},a.id)})})]}):e.jsx(J,{title:"No OCR jobs yet",description:"Upload a document to get started",icon:e.jsx(Z,{className:"h-8 w-8 text-muted-foreground"})})})]}),e.jsx(z,{open:!!t,onOpenChange:()=>h(null),children:e.jsxs(Q,{className:"max-w-lg",children:[e.jsx(K,{children:e.jsx(V,{children:"Extracted Fields"})}),(t==null?void 0:t.extractedData)&&e.jsx("div",{className:"space-y-3",children:Object.entries(t.extractedData).map(([a,s])=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wider w-36 shrink-0 pt-0.5",children:a.replace(/_/g," ")}),e.jsx("span",{className:"text-sm font-medium",children:String(s)})]},a))})]})})]})})}export{xe as default};
